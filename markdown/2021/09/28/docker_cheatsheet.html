<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Docker Cheatsheet</h1><p class="page-description">Most used command while working with Docker</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-09-28T00:00:00-05:00" itemprop="datePublished">
        Sep 28, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#markdown">markdown</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#images">Images</a></li>
<li class="toc-entry toc-h2"><a href="#containers">Containers</a></li>
<li class="toc-entry toc-h2"><a href="#system">System</a></li>
<li class="toc-entry toc-h2"><a href="#set-up-rootless-docker">Set up rootless docker</a></li>
</ul><h2 id="images">
<a class="anchor" href="#images" aria-hidden="true"><span class="octicon octicon-link"></span></a>Images</h2>

<p>One can download (pull) a docker image from <a href="https://hub.docker.com/">Docker Hub</a> or respective websites:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># docker pull &lt;image-name&gt;:&lt;tag&gt;</span>
docker pull tensorflow/tensorflow:2.4.0-gpu-jupyter
</code></pre></div></div>

<p>Check the downloaded images with:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker images
</code></pre></div></div>

<p>Sometimes we may need to do something on an image without saving or alloting extra space. To create and run a temporary container to be deleted on stopping:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">-it</span> tensorflow/tensorflow:2.4.0-gpu-jupyter 
</code></pre></div></div>

<h2 id="containers">
<a class="anchor" href="#containers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Containers</h2>

<p>Create a new container from an image with following flags</p>
<ol>
  <li>
<code class="language-plaintext highlighter-rouge">-v</code>: for telling docker to use a shared directory between host and container</li>
  <li>
<code class="language-plaintext highlighter-rouge">-p \&lt;host-port\&gt;\&lt;container-port\&gt;</code>: is to use port forwarding, an application running on &lt;container-port&gt; can be accessed only with &lt;host-port&gt; in host.</li>
  <li>
<code class="language-plaintext highlighter-rouge">--name</code> generates a name for the container for easy reference in other commands</li>
  <li>
<code class="language-plaintext highlighter-rouge">--gpus all</code> tells docker to use all GPUs available on host</li>
  <li>
<code class="language-plaintext highlighter-rouge">--memory-swap</code> Restricts RAM+Swap usage</li>
  <li>
<code class="language-plaintext highlighter-rouge">-it</code> makes sure container awaits after starting instead of instantly shutting down if no startup scripts are configured.</li>
</ol>

<p>To create new container with default params:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker create tensorflow/tensorflow:2.4.0-gpu-jupyter 
</code></pre></div></div>

<p>To create new container with manual params:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker create <span class="nt">-it</span> <span class="se">\</span>
<span class="nt">-v</span> <span class="se">\p</span>ath_in_host:<span class="se">\p</span>ath_in_container <span class="se">\</span>
<span class="nt">-p9000</span>:8888 <span class="se">\</span>
<span class="nt">--name</span> aaai <span class="se">\</span>
<span class="nt">--cpus</span> 2 <span class="se">\</span>
<span class="nt">--gpus</span> all <span class="se">\ </span><span class="c"># To use specific gpus: --gpu '"device=0,2"'</span>
<span class="nt">--memory</span> 90g <span class="se">\ </span><span class="c"># Uses 90g memory</span>
<span class="nt">--memory-swap</span> 100g <span class="se">\ </span><span class="c"># --memory-swap is a modifier flag that only has meaning if --memory is also set. In this case 10g of swap will be used.</span>
tensorflow/tensorflow:2.4.0-gpu-jupyter
</code></pre></div></div>

<p>Update some of the above configurations after container creation:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># change RAM limit of a container named "aaai"</span>
docker update <span class="nt">--memory-swap</span> 50g aaai
</code></pre></div></div>

<blockquote>
  <p>Note: In general, changes made to container persist when container is stopped.</p>
</blockquote>

<p>Check containers:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ps <span class="c"># shows running containers</span>
docker ps <span class="nt">-a</span> <span class="c"># shows all containers</span>
</code></pre></div></div>

<p>Start a container (default script will be executed with this if any):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># docker start &lt;container-name&gt;</span>
docker start aaai
</code></pre></div></div>

<p>Stop a container:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># docker stop &lt;container-name&gt; </span>
docker stop aaai
</code></pre></div></div>

<p>Delete a container:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># docker rm &lt;container-name&gt;</span>
docker <span class="nb">rm </span>aaai
</code></pre></div></div>

<p>Go to a running container’s shell:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#docker exec -it &lt;container-name&gt; bash</span>
docker <span class="nb">exec</span> <span class="nt">-it</span> aaai bash <span class="c"># -it stands for interactive</span>
</code></pre></div></div>

<p>Execute any command on a running container without opening a shell in container:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># docker exec -it &lt;container-name&gt; &lt;command&gt;</span>
docker <span class="nb">exec</span> <span class="nt">-it</span> aaai jupyter notebook list
</code></pre></div></div>

<p>Check container logs (including shell commands output):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># docker logs &lt;container-name&gt;</span>
docker logs aaai
</code></pre></div></div>

<h2 id="system">
<a class="anchor" href="#system" aria-hidden="true"><span class="octicon octicon-link"></span></a>System</h2>

<p>Check all images, all containers and space occupied by them:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker system <span class="nb">df</span> <span class="nt">-v</span>
</code></pre></div></div>

<h2 id="set-up-rootless-docker">
<a class="anchor" href="#set-up-rootless-docker" aria-hidden="true"><span class="octicon octicon-link"></span></a>Set up rootless docker</h2>

<p>Refer to this guide: https://docs.docker.com/engine/security/rootless/</p>

<p>Main steps:</p>

<ul>
  <li>Run <code class="language-plaintext highlighter-rouge">dockerd-rootless-setuptool.sh install</code>.</li>
  <li>Setup PATH and DOCKER_HOME as suggested by command output.</li>
  <li>
<code class="language-plaintext highlighter-rouge">systemctl --user restart docker</code>.</li>
  <li>Try <code class="language-plaintext highlighter-rouge">docker images</code> to check if things worked.</li>
  <li>Try <code class="language-plaintext highlighter-rouge">docker run --rm hello-world</code> to check if things really worked.</li>
</ul>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="patel-zeel/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/markdown/2021/09/28/docker_cheatsheet.html" hidden></a>
</article>